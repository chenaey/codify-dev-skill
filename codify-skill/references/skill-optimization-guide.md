# Codify Skill 优化原则

本文档定义 codify-skill 的设计原则和优化规范，供维护者参考。

---

## 定位

**codify-skill 是设计稿还原工具，不是特定框架的代码生成器。**

| ✅ 正确定位 | ❌ 错误定位 |
|------------|-----------|
| 从 JSON + 截图还原设计到任意框架 | Vue/React 代码生成器 |
| 框架无关的布局和样式还原 | 特定框架的最佳实践教程 |
| 提供设计数据，由模型决定实现方式 | 规定死每种情况的处理方法 |

---

## 核心原则

### 1. 信任模型能力

**假设模型很聪明**——只提供模型不具备的信息。

```
❌ "Flex 布局时，如果 justifyContent 是 space-between，则子元素会..."
✅ "从 layout.mode 和 layout.justifyContent 提取布局属性"
```

模型已知：CSS、HTML、各种框架语法、布局原理
模型未知：JSON 结构、API 端点、设计平台特有概念

### 2. 框架无关

skill 应该描述**如何从设计数据中提取信息**，而不是**如何写某个框架的代码**。

```
❌ "Vue 组件用 <script setup>，React 用函数组件..."
✅ "从 customStyle 提取样式，从 text.content 提取文本"
```

框架选择由用户指定或模型根据项目上下文推断。

### 3. 数据驱动

所有样式和内容**必须从 JSON 提取**，截图仅用于理解结构。

| 数据来源 | 用途 | 禁止用途 |
|---------|------|---------|
| 截图 | 理解布局层级、组件边界 | 提取颜色、尺寸、字体 |
| JSON | 精确样式值、文本内容 | 判断整体布局结构 |

### 4. 简洁优先

遵循 skill-creator 的 token 经济原则：

```
❌ 大段解释 + 多种情况分析
✅ 一条规则 + 必要时一个示例
```

**每条规则都要问：这值得占用 context window 吗？**

---

## 文档结构原则

### Progressive Disclosure

```
SKILL.md (入口，<100 行)
    ↓ 触发时加载
references/ (按需读取)
    ├── codegen-rules.md   ← 生成代码时
    ├── design-schema.md   ← 理解 JSON 时
    ├── phased-workflow.md ← 复杂设计时
    └── api.md             ← 调用 API 时
```

**原则：**
- SKILL.md 只放流程骨架和触发条件
- 详细规则放 references/，按需加载
- 避免 references 之间相互引用（保持一层深度）

### 避免重复

信息只在一个地方定义：

```
❌ SKILL.md 和 codegen-rules.md 都写样式提取规则
✅ SKILL.md 引用 codegen-rules.md，不重复内容
```

---

## 常见错误

### 错误 1：过度规定实现细节

```
❌ "弹窗关闭按钮应使用 position: absolute; top: 12px; right: 12px;"
✅ "根据 layout.positioning 判断定位方式"
```

### 错误 2：假设特定框架

```
❌ "使用 v-for 遍历列表项"
✅ "识别重复节点模式，生成循环结构"
```

### 错误 3：解释模型已知的知识

```
❌ "Flex 容器的 gap 属性用于设置子元素间距..."
✅ "间距从 layout.gap 提取"
```

### 错误 4：流程顺序冲突

```
❌ Step 1: 判断复杂度  Step 2: 获取截图  （没有截图怎么判断？）
✅ Step 1: 获取截图  Step 2: 判断复杂度
```

### 错误 5：必读文档放在"按需"位置

```
❌ 参考文档表格里写 "codegen-rules.md — 生成代码前读"
✅ 单独列出 "## 必读文档" 明确标注
```

---

## 规则编写规范

### 用祈使句

```
❌ "你应该从 customStyle 中提取样式"
✅ "从 customStyle 提取样式"
```

### 用表格代替长文

```
❌ 当节点类型是 TEXT 时，从 text.content 提取文本内容。
   当节点类型是 ICON 时，需要下载 SVG 资源。
   当节点类型是 IMAGE 时...

✅ | 节点类型 | 提取方式 |
   |---------|---------|
   | TEXT | text.content |
   | ICON | 下载 SVG |
   | IMAGE | customStyle.background |
```

### 明确约束边界

```
❌ "尽量使用设计稿中的颜色"
✅ "颜色必须从 customStyle 提取，禁止猜测"
```

---

## 复杂度处理原则

### 判断标准

| 条件（满足任一） | 复杂度 |
|-----------------|--------|
| ≥3 个独立组件 | 复杂 |
| ≥4 层嵌套 | 复杂 |
| 完整页面布局 | 复杂 |
| ≥5 个重复项 | 复杂 |

### 复杂设计的核心约束

**禁止一次性生成所有代码。**

原因：
1. 上下文过长导致后半部分质量下降
2. 无法逐个验证每个组件的还原度
3. 出错时难以定位问题

**必须拆分组件，逐个实现。**

---

## 迭代检查清单

更新 skill 时，检查：

- [ ] 是否保持框架无关？
- [ ] 是否信任模型能力，不解释已知知识？
- [ ] 是否用表格/清单代替长文？
- [ ] 流程顺序是否有逻辑冲突？
- [ ] 必读文档是否明确标注？
- [ ] 信息是否只在一处定义？
